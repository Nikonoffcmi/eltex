1) Создайте на сервере для 1 практики ключ ssh при помощи программы ssh-keygen

> ssh-keygen -t rsa
Generating public/private rsa key pair.
Enter file in which to save the key (/home/eltex-pg1-v24/.ssh/id_rsa):
Created directory '/home/eltex-pg1-v24/.ssh'.
Enter passphrase (empty for no passphrase):
Enter same passphrase again:
Your identification has been saved in /home/eltex-pg1-v24/.ssh/id_rsa
Your public key has been saved in /home/eltex-pg1-v24/.ssh/id_rsa.pub
The key fingerprint is:
SHA256:Jz6hqRxgRmIxDbIxewgfA/l9WmgHEvC7q2D2tU7lYtg eltex-pg1-v24@eltex
The key's randomart image is:
+---[RSA 3072]----+
|BB*.             |
|+O++.            |
|=o=o o           |
|.+..+ +          |
|  =. = .S .      |
| o o+ o+ +       |
|.o...Eo.o        |
|+ .o+oo  .       |
|....+o           |
+----[SHA256]-----+

2) Скопируйте созданный ключ на сервер для 2 практики для пользователя root при помощи программы ssh-copy-id

> ssh-copy-id -i ~/.ssh/id_rsa.pub root@172.16.9.198
/usr/bin/ssh-copy-id: INFO: Source of key(s) to be installed: "/home/eltex-pg1-v                          24/.ssh/id_rsa.pub"
The authenticity of host '172.16.9.198 (172.16.9.198)' can't be established.
ED25519 key fingerprint is SHA256:YNVzj+RtetZfXv5XUn/CUjeEcaMD4eg3jy8EuGGIS+o.
This key is not known by any other names.
Are you sure you want to continue connecting (yes/no/[fingerprint])? yes
/usr/bin/ssh-copy-id: INFO: attempting to log in with the new key(s), to filter out any that are already installed
/usr/bin/ssh-copy-id: INFO: 1 key(s) remain to be installed -- if you are prompted now it is to install the new keys
root@172.16.9.198's password:

Number of key(s) added: 1

Now try logging into the machine, with:   "ssh 'root@172.16.9.198'"
and check to make sure that only the key(s) you wanted were added.

3) Подключитесь к серверу для 2 практики под пользователем root и сравните содержимое файла открытого ключа на сервере 1 .ssh/*.pub и файла /.ssh/authorized_keys на сервере для 2 практики, а так же права доступа для каждого из файлов

> cat ./.ssh/id_rsa.pub
ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABgQDB//8lsJlRUSruMqccLgHdF9oNzXQ7G+XZHhYWPkwKc5aGi+ukJvyE5XOi3qMQ8vOX3XZ6sxODUX8MgS46DikkF1kbiPtGmbaYYVkUHNeuKsCa4LAKYnHQLe6EgQdEF6j+ewR41FbTY74jN5wumz82MayCgp9jygU1Pa64Tf5F4Vnf3h/AIW5h3OXRZwDFkGwUyRviyBjrf12Ao/QrJk+jjW2Cbm5fgtGEDe7Q2O9j637Qv4b2PfORub/RU10sD+SCK8GsG8/6PlQKrX/s7KI+7rFdEhUSsdFKaHboPqISwZ7JkklVtOG0VHJZlt1FXyXY65hvdhoE9lBLcNF6ws4ZVuh9gDZ87yh1UUoUkVvV64/Ud+UkwUpX+7rnuFn/L9gRIzi6nimFCRqTNTw7cFLkyhPkSorH3ySNoVFQGdVVEp/YP/fEjcw3XA9vSyGvxF0vTkQxUfbsWEOKlYM1UVBiyCpRB6Aw+XHF5hbWbUlgI91SRIzbjsEDB8+XHgg1Ogs= eltex-pg1-v24@eltex

> eltex-pg1-v24@eltex:~$ ls -al ./.ssh/id_rsa.pub
-rw-r--r-- 1 eltex-pg1-v24 eltex-pg1-v24 573 Mar 13 18:15 ./.ssh/id_rsa.pub

> eltex-pg1-v24@eltex:~$ ssh 'root@172.16.9.198'
Welcome to Ubuntu 24.04.2 LTS (GNU/Linux 6.8.0-55-generic x86_64)

 * Documentation:  https://help.ubuntu.com
 * Management:     https://landscape.canonical.com
 * Support:        https://ubuntu.com/pro

 System information as of Thu Mar 13 11:22:14 AM UTC 2025

  System load:  0.0                Processes:              113
  Usage of /:   37.8% of 14.66GB   Users logged in:        0
  Memory usage: 5%                 IPv4 address for ens18: 172.16.9.198
  Swap usage:   0%

 * Strictly confined Kubernetes makes edge and IoT secure. Learn how MicroK8s
   just raised the bar for easy, resilient and secure K8s cluster deployment.

   https://ubuntu.com/engage/secure-kubernetes-at-the-edge

Expanded Security Maintenance for Applications is not enabled.

0 updates can be applied immediately.

Enable ESM Apps to receive additional future security updates.
See https://ubuntu.com/esm or run: sudo pro status


> root@eltex-practice2-pg1-v24:~# cat ./.ssh/authorized_keys
ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABgQDB//8lsJlRUSruMqccLgHdF9oNzXQ7G+XZHhYWPkwKc5aGi+ukJvyE5XOi3qMQ8vOX3XZ6sxODUX8MgS46DikkF1kbiPtGmbaYYVkUHNeuKsCa4LAKYnHQLe6EgQdEF6j+ewR41FbTY74jN5wumz82MayCgp9jygU1Pa64Tf5F4Vnf3h/AIW5h3OXRZwDFkGwUyRviyBjrf12Ao/QrJk+jjW2Cbm5fgtGEDe7Q2O9j637Qv4b2PfORub/RU10sD+SCK8GsG8/6PlQKrX/s7KI+7rFdEhUSsdFKaHboPqISwZ7JkklVtOG0VHJZlt1FXyXY65hvdhoE9lBLcNF6ws4ZVuh9gDZ87yh1UUoUkVvV64/Ud+UkwUpX+7rnuFn/L9gRIzi6nimFCRqTNTw7cFLkyhPkSorH3ySNoVFQGdVVEp/YP/fEjcw3XA9vSyGvxF0vTkQxUfbsWEOKlYM1UVBiyCpRB6Aw+XHF5hbWbUlgI91SRIzbjsEDB8+XHgg1Ogs= eltex-pg1-v24@eltex

> root@eltex-practice2-pg1-v24:~# ls -al .ssh/authorized_keys
-rw------- 1 root root 573 Mar 13 11:30 .ssh/authorized_keys

4) Создайте пользователя user1 при помощи команды useradd, укажите необходимость создания домашнего каталога и shell /bin/bash. Создайте пароль пользователю user1

> root@eltex-practice2-pg1-v24:~# useradd -m -s /bin/bash user1

> root@eltex-practice2-pg1-v24:~# passwd user1
New password:
Retype new password:
passwd: password updated successfully

5) Создайте пользователя user2 и user3 при помощи команды adduser

> root@eltex-practice2-pg1-v24:~# adduser user2
info: Adding user `user2' ...
info: Selecting UID/GID from range 1000 to 59999 ...
info: Adding new group `user2' (1002) ...
info: Adding new user `user2' (1002) with group `user2 (1002)' ...
info: Creating home directory `/home/user2' ...
info: Copying files from `/etc/skel' ...
New password:
Retype new password:
passwd: password updated successfully
Changing the user information for user2
Enter the new value, or press ENTER for the default
        Full Name []:
        Room Number []:
        Work Phone []:
        Home Phone []:
        Other []:
Is the information correct? [Y/n] Y
info: Adding new user `user2' to supplemental / extra groups `users' ...
info: Adding user `user2' to group `users' ...

> root@eltex-practice2-pg1-v24:~# adduser user3
info: Adding user `user3' ...
info: Selecting UID/GID from range 1000 to 59999 ...
info: Adding new group `user3' (1003) ...
info: Adding new user `user3' (1003) with group `user3 (1003)' ...
info: Creating home directory `/home/user3' ...
info: Copying files from `/etc/skel' ...
New password:
Retype new password:
passwd: password updated successfully
Changing the user information for user3
Enter the new value, or press ENTER for the default
        Full Name []:
        Room Number []:
        Work Phone []:
        Home Phone []:
        Other []:
Is the information correct? [Y/n] Y
info: Adding new user `user3' to supplemental / extra groups `users' ...
info: Adding user `user3' to group `users' ...

6) Для пользователя user3 смените shell на /usr/sbin/nologin (man usermod), выполните вход под этим пользователем при помощи утилиты su, сначала без дополнительных параметров, затем с явным указанием shell в параметрах su. Выполните logout

> root@eltex-practice2-pg1-v24:~# usermod -s /usr/sbin/nologin user3
> root@eltex-practice2-pg1-v24:~# su user3
This account is currently not available.

> root@eltex-practice2-pg1-v24:~# su -s /bin/bash - user3
> user3@eltex-practice2-pg1-v24:~$
exit

7) Создайте новую группу и добавьте её для всех пользователей user* как дополнительную, посмотрите список групп всех пользователей user*

> root@eltex-practice2-pg1-v24:~# groupadd newgroup
> root@eltex-practice2-pg1-v24:~# usermod -aG newgroup user1
> root@eltex-practice2-pg1-v24:~# usermod -aG newgroup user2
> root@eltex-practice2-pg1-v24:~# usermod -aG newgroup user3
> root@eltex-practice2-pg1-v24:~# groups user1
user1 : user1 newgroup
> root@eltex-practice2-pg1-v24:~# groups user2
user2 : user2 users newgroup
> root@eltex-practice2-pg1-v24:~# groups user3
user3 : user3 users newgroup
> root@eltex-practice2-pg1-v24:~# getent group newgroup
newgroup:x:1004:user1,user2,user3

8) Создайте каталог /opt/share и назначьте группу из предыдущего пункта его владельцем, установите на этот каталог бит SGID, права для группы rwx.

> root@eltex-practice2-pg1-v24:~# mkdir -p /opt/share
> root@eltex-practice2-pg1-v24:~# chown :newgroup /opt/share
> root@eltex-practice2-pg1-v24:~# chmod 2770 /opt/share
> root@eltex-practice2-pg1-v24:~# ls -ld /opt/share
drwxrws--- 2 root newgroup 4096 Mar 13 12:17 /opt/share


9) Для user1 задайте перманентно umask, снимающий право чтения для «прочих»

> user1@eltex-practice2-pg1-v24:~$ umask 0004
> user1@eltex-practice2-pg1-v24:~$ umask
0004


10) Создайте каждым из пользователей новые файлы в каталоге /opt/share, удалите файлы созданные другими пользователями

> user3@eltex-practice2-pg1-v24:~$ ls -l /opt/share
total 0
-rw-rw--w- 1 user1 newgroup 0 Mar 17 05:05 user1_file.txt
-rw-rw-r-- 1 user2 newgroup 0 Mar 17 05:05 user2_file.txt
-rw-rw-r-- 1 user3 newgroup 0 Mar 17 05:08 user3_file.txt
> user3@eltex-practice2-pg1-v24:~$
logout
> root@eltex-practice2-pg1-v24:~# su - user1
> user1@eltex-practice2-pg1-v24:~$ rm /opt/share/user2_file.txt /opt/share/user3_file.txt
> user1@eltex-practice2-pg1-v24:~$ ls -l /opt/share
total 0
-rw-rw--w- 1 user1 newgroup 0 Mar 17 05:05 user1_file.txt
> user1@eltex-practice2-pg1-v24:~$
logout
> root@eltex-practice2-pg1-v24:~# su - user2
> user2@eltex-practice2-pg1-v24:~$ rm /opt/share/user1_file.txt
> user2@eltex-practice2-pg1-v24:~$ ls -l /opt/share/
total 0
> user2@eltex-practice2-pg1-v24:~$ touch /opt/share/user2_file.txt
> user2@eltex-practice2-pg1-v24:~$ ls -l /opt/share/
total 0
-rw-rw-r-- 1 user2 newgroup 0 Mar 17 05:11 user2_file.txt
> user2@eltex-practice2-pg1-v24:~$
logout
> root@eltex-practice2-pg1-v24:~# su -s /bin/bash - user3
> user3@eltex-practice2-pg1-v24:~$ rm /opt/share/user2_file.txt
> user3@eltex-practice2-pg1-v24:~$ ls -l /opt/share
total 0

11) Повторите предыдущий пункт, предварительно установив sticky bit на каталоге /opt/share

> root@eltex-practice2-pg1-v24:~# chmod +t /opt/share
> root@eltex-practice2-pg1-v24:~# ls -ld /opt/share/
drwxrws--T 2 root newgroup 4096 Mar 17 05:12 /opt/share/
> root@eltex-practice2-pg1-v24:~# ls -l /opt/share/
total 0
-rw-rw-r-- 1 user1 newgroup 0 Mar 17 05:28 user1_file.txt
-rw-rw-r-- 1 user2 newgroup 0 Mar 17 05:28 user2_file.txt
-rw-rw-r-- 1 user3 newgroup 0 Mar 17 05:28 user3_file.txt
> root@eltex-practice2-pg1-v24:~# su - user1
> user1@eltex-practice2-pg1-v24:~$ rm /opt/share/user2_file.txt
rm: cannot remove '/opt/share/user2_file.txt': Operation not permitted
> user1@eltex-practice2-pg1-v24:~$
logout
> root@eltex-practice2-pg1-v24:~# su - user2
> user2@eltex-practice2-pg1-v24:~$ rm /opt/share/user1_file.txt
rm: cannot remove '/opt/share/user1_file.txt': Operation not permitted
> user2@eltex-practice2-pg1-v24:~$
logout
> root@eltex-practice2-pg1-v24:~# su -s /bin/bash - user3
> user3@eltex-practice2-pg1-v24:~$ rm /opt/share/user2_file.txt
rm: cannot remove '/opt/share/user2_file.txt': Operation not permitted


12) Разрешите user1 выполнять привилегированную команду dmesg при помощи команды sudo, а user2 – при помощи скрипта на языке bash с установленным флагом SUID

> root@eltex-practice2-pg1-v24:~# visudo -f /etc/sudoers.d/user1_dmesg
Добавлена в файл строка: user1 ALL=(ALL) NOPASSWD: /usr/bin/dmesg
> root@eltex-practice2-pg1-v24:~# su - user1
> user1@eltex-practice2-pg1-v24:~$ sudo dmesg
[    0.000000] Linux version 6.8.0-55-generic (buildd@lcy02-amd64-095) (x86_64-linux-gnu-gcc-13 (Ubuntu 13.3.0-6ubuntu2~24.04) 13.3.0, GNU ld (GNU Binutils for Ubuntu) 2.42) #57-Ubuntu SMP PREEMPT_DYNAMIC Wed Feb 12 23:42:21 UTC 2025 (Ubuntu 6.8.0-55.57-generic 6.8.12)
[    0.000000] Command line: BOOT_IMAGE=/vmlinuz-6.8.0-55-generic root=/dev/mapper/ubuntu--vg-ubuntu--lv ro

> root@eltex-practice2-pg1-v24:~# vi /usr/local/bin/dmesg_wrapper
В файл добавлено: 
#!/bin/bash
/usr/bin/dmesg
> root@eltex-practice2-pg1-v24:~# chown root:root /usr/local/bin/dmesg_wrapper
> root@eltex-practice2-pg1-v24:~# chmod 4755 /usr/local/bin/dmesg_wrapper
> root@eltex-practice2-pg1-v24:~# su - user2
> user2@eltex-practice2-pg1-v24:~$ /usr/local/bin/dmesg_wrapper
dmesg: read kernel buffer failed: Operation not permitted

13) Для всех пользователей user* задайте время действия пароля – 10 дней.

> root@eltex-practice2-pg1-v24:~# chage -M 10 user1
> root@eltex-practice2-pg1-v24:~# chage -M 10 user2
> root@eltex-practice2-pg1-v24:~# chage -M 10 user3
> root@eltex-practice2-pg1-v24:~# chage -l user1
Last password change                                    : Mar 13, 2025
Password expires                                        : Mar 23, 2025
Password inactive                                       : never
Account expires                                         : never
Minimum number of days between password change          : 0
Maximum number of days between password change          : 10
Number of days of warning before password expires       : 7

14) Отредактируйте файл /etc/motd, вписав туда свое имя и фамилию

> root@eltex-practice2-pg1-v24:~# vi /etc/motd
> iroot@eltex-practice2-pg1-v24:~# cat /etc/motd
Чумадевкий Никита

15) Создайте копию содержимого каталога /etc в каталог /root/etc_backup при помощи программы rcync

> root@eltex-practice2-pg1-v24:~# rsync -a /etc/ /root/etc_backup/
> root@eltex-practice2-pg1-v24:~# ls -l /root/
total 4
drwxr-xr-x 109 root root 4096 Mar 17 05:55 etc_backup

16) Заархивируйте содержимое каталога /root/etc_backup архиватором tar, используйте алгоритмы сжатия gzip, bzip2, 7zip, сравните размеры полученных файлов

> root@eltex-practice2-pg1-v24:~# tar -czf /root/etc_backup_gz.tar.gz -C /root/etc_backup .
> root@eltex-practice2-pg1-v24:~# tar -cjf /root/etc_backup_bz2.tar.bz2 -C /root/etc_backup .
> tar -cf /root/etc_backup.tar -C /root/etc_backup .
> 7z a -t7z /root/etc_backup_7z.7z /root/etc_backup.tar
> rm /root/etc_backup.tar
> root@eltex-practice2-pg1-v24:~# ls -lh /root/
total 1.6M
drwxr-xr-x 109 root root 4.0K Mar 17 05:55 etc_backup
-rw-r--r--   1 root root 475K Mar 17 06:07 etc_backup_7z.7z
-rw-r--r--   1 root root 546K Mar 17 06:06 etc_backup_bz2.tar.bz2
-rw-r--r--   1 root root 581K Mar 17 06:04 etc_backup_gz.tar.gz

17) Отредактируйте файл /etc/motd, вписав туда текущую дату и время, синхронизируйте каталог /root/etc_backup с каталогом /etc при помощи rsync, добавьте файл motd в архив, сжатый gzip

> root@eltex-practice2-pg1-v24:~# vi /etc/motd
> root@eltex-practice2-pg1-v24:~# cat /etc/motd
Чумадевкий Никита
17.03.2025 13:29
> root@eltex-practice2-pg1-v24:~# rsync -a /etc/ /root/etc_backup
> root@eltex-practice2-pg1-v24:/# tar -czf /root/etc_backup_gz.tar.gz etc/motd

18) Сравните содержимое архива, упакованного bzip2 с сорержимым каталога /root/etc_backup

> root@eltex-practice2-pg1-v24:/# mkdir /root/etc_backup_bzip2
> root@eltex-practice2-pg1-v24:/# tar -xjf /root/etc_backup_bz2.tar.bz2 -C /root/etc_backup_bzip2/
> root@eltex-practice2-pg1-v24:/# diff -r /root/etc_backup/ /root/etc_backup_bzip2/
diff -r /root/etc_backup/motd /root/etc_backup_bzip2/motd
2d1
< 17.03.2025 13:29
diff: /root/etc_backup/mtab: No such file or directory
diff: /root/etc_backup_bzip2/mtab: No such file or directory
diff: /root/etc_backup/os-release: No such file or directory
diff: /root/etc_backup_bzip2/os-release: No such file or directory
diff: /root/etc_backup/resolv.conf: No such file or directory
diff: /root/etc_backup_bzip2/resolv.conf: No such file or directory

19) Распакуйте архивы etc_backup, упакованные gzip и 7zip в каталоги /root/etc_backup_gzip и /root/etc_backup_7zip, сравните программой diff файлы motd в этих каталогах.

> root@eltex-practice2-pg1-v24:/# tar -xzf /root/etc_backup_gz.tar.gz -C /root/etc_backup_gzip
> root@eltex-practice2-pg1-v24:/# 7z x /root/etc_backup_7z.7z -o/root/etc_backup_7zip

7-Zip 23.01 (x64) : Copyright (c) 1999-2023 Igor Pavlov : 2023-06-20
 64-bit locale=en_US.UTF-8 Threads:2 OPEN_MAX:1024

Scanning the drive for archives:
1 file, 485776 bytes (475 KiB)

Extracting archive: /root/etc_backup_7z.7z
--
Path = /root/etc_backup_7z.7z
Type = 7z
Physical Size = 485776
Headers Size = 138
Method = LZMA2:22
Solid = -
Blocks = 1

Everything is Ok

Size:       3471360
Compressed: 485776
> root@eltex-practice2-pg1-v24:/# tar -xf /root/etc_backup_7zip/etc_backup.tar -C /root/etc_backup_7zip/
> root@eltex-practice2-pg1-v24:/# diff /root/etc_backup_gzip/etc/motd /root/etc_backup_7zip/motd
2d1
< 17.03.2025 13:29

